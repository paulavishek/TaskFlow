<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Column Scroll Test</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/scroll-debug.css">
    <style>
        body {
            padding: 20px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .add-task-btn {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kanban Column Scroll Test</h1>
        
        <div class="test-section">
            <h3>Column with Many Tasks (Should Scroll)</h3>
            <button class="btn btn-primary add-task-btn" onclick="addTask('test-column-1')">Add Task</button>
            <button class="btn btn-danger add-task-btn" onclick="removeTask('test-column-1')">Remove Task</button>
            <div class="kanban-board">
                <div class="kanban-column" id="column-1">
                    <div class="kanban-column-header">
                        <h5>Test Column 1</h5>
                    </div>
                    <div class="kanban-column-tasks" id="test-column-1" data-column-id="1">
                        <div class="kanban-task" id="task-1">Task 1</div>
                        <div class="kanban-task" id="task-2">Task 2</div>
                        <div class="kanban-task" id="task-3">Task 3</div>
                        <div class="kanban-task" id="task-4">Task 4</div>
                        <div class="kanban-task" id="task-5">Task 5</div>
                        <div class="kanban-task" id="task-6">Task 6 - Long task content that should wrap and take more space to test scrolling behavior</div>
                        <div class="kanban-task" id="task-7">Task 7</div>
                        <div class="kanban-task" id="task-8">Task 8</div>
                    </div>
                </div>
                
                <div class="kanban-column" id="column-2">
                    <div class="kanban-column-header">
                        <h5>Test Column 2</h5>
                    </div>
                    <div class="kanban-column-tasks" id="test-column-2" data-column-id="2">
                        <div class="kanban-task" id="task-9">Task 1</div>
                        <div class="kanban-task" id="task-10">Task 2</div>
                    </div>
                </div>
            </div>
        </div>          <div class="test-section">
            <h3>Debug Info</h3>            <button class="btn btn-info" onclick="showDebugInfo()">Show Column Info</button>
            <button class="btn btn-warning" onclick="manualUpdate()">Manual Update</button>
            <button class="btn btn-danger" onclick="forceCleanup()">Force Cleanup</button>
            <button class="btn btn-secondary" onclick="toggleDebugOutlines()">Toggle Debug Outlines</button>
            <div class="alert alert-info mt-2">
                <strong>Console Commands:</strong><br>
                <code>window.kanbanForceCleanup()</code> - Force cleanup all columns<br>
                <code>window.kanbanUpdateColumnScrolling()</code> - Update column scrolling<br>
                <code>COLUMN_SCROLL_CONFIG.TASK_THRESHOLD = 3</code> - Change threshold
            </div>
            <div id="debug-info" class="mt-3"></div>
        </div>
    </div>

    <script src="js/kanban.js"></script>
    <script>
        let taskCounter = 20;
        
        function addTask(columnId) {
            const column = document.getElementById(columnId);
            const newTask = document.createElement('div');
            newTask.className = 'kanban-task';
            newTask.id = 'task-' + taskCounter;
            newTask.textContent = 'Task ' + taskCounter;
            column.appendChild(newTask);
            taskCounter++;
            
            // Update scrolling
            if (typeof window.kanbanUpdateColumnScrolling === 'function') {
                window.kanbanUpdateColumnScrolling();
            }
        }
        
        function removeTask(columnId) {
            const column = document.getElementById(columnId);
            const tasks = column.querySelectorAll('.kanban-task');
            if (tasks.length > 0) {
                tasks[tasks.length - 1].remove();
                // Update scrolling
                if (typeof window.kanbanUpdateColumnScrolling === 'function') {
                    window.kanbanUpdateColumnScrolling();
                }
            }
        }
          function showDebugInfo() {
            const debugDiv = document.getElementById('debug-info');
            const columns = document.querySelectorAll('.kanban-column-tasks');
            let info = '<h5>Column Debug Info:</h5>';
            
            columns.forEach((column, index) => {
                const tasks = column.querySelectorAll('.kanban-task');
                const isScrollable = column.classList.contains('scrollable');
                const styles = getComputedStyle(column);
                const wrapper = column.closest('.kanban-column');
                const wrapperStyles = getComputedStyle(wrapper);
                
                info += `<div class="card mb-2">
                    <div class="card-body">
                        <h6>Column ${index + 1}</h6>
                        <p><strong>Tasks:</strong> ${tasks.length}</p>
                        <p><strong>Is Scrollable:</strong> ${isScrollable}</p>
                        <p><strong>Column Position:</strong> ${wrapperStyles.position}</p>
                        <p><strong>Column Overflow:</strong> ${wrapperStyles.overflow}</p>
                        <p><strong>Tasks Height:</strong> ${styles.height}</p>
                        <p><strong>Tasks Max Height:</strong> ${styles.maxHeight}</p>
                        <p><strong>Tasks Overflow Y:</strong> ${styles.overflowY}</p>
                        <p><strong>Tasks Position:</strong> ${styles.position}</p>
                        <p><strong>Scroll Height:</strong> ${column.scrollHeight}px</p>
                        <p><strong>Client Height:</strong> ${column.clientHeight}px</p>
                        <p><strong>Offset Parent:</strong> ${column.offsetParent ? column.offsetParent.tagName : 'null'}</p>
                        <p><strong>Bounding Rect:</strong> ${JSON.stringify({
                            top: Math.round(column.getBoundingClientRect().top),
                            left: Math.round(column.getBoundingClientRect().left),
                            width: Math.round(column.getBoundingClientRect().width),
                            height: Math.round(column.getBoundingClientRect().height)
                        })}</p>
                    </div>
                </div>`;
            });
            
            debugDiv.innerHTML = info;
        }
          function manualUpdate() {
            if (typeof window.kanbanUpdateColumnScrolling === 'function') {
                window.kanbanUpdateColumnScrolling();
                showDebugInfo();
            }
        }
          function toggleDebugOutlines() {
            const debugCSS = document.querySelector('link[href="css/scroll-debug.css"]');
            if (debugCSS.disabled) {
                debugCSS.disabled = false;
            } else {
                debugCSS.disabled = true;
            }
        }
        
        function forceCleanup() {
            if (typeof window.kanbanForceCleanup === 'function') {
                window.kanbanForceCleanup();
                setTimeout(() => {
                    showDebugInfo();
                }, 500);
            }
        }
        
        // Auto-show debug info on load
        setTimeout(() => {
            showDebugInfo();
        }, 1000);
    </script>
</body>
</html>
